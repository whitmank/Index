# Dev Log - 2026-01-15

## Session Focus
Extracted D3 force simulation from archived GraphTool app and integrated as new GraphView page with zoom functionality

## Changes Made

### Backend Module Creation
- Created new `backend/force-sim` workspace module to house D3 force simulation logic
- Extracted and refactored force simulation code from `archive/app-0.1` (previous GraphTool implementation)
- Structured as independent module with clear API: createSimulation, reheatSimulation, stopSimulation, addNode, removeNode, addLink, removeLink, updateSimulationSize
- Added d3-force v3.0.0 as dependency

### GraphView Frontend Page
- Created new `frontend/src/pages/GraphView/` with full canvas-based graph visualization
- Implemented real-time force simulation rendering with 60fps animation loop
- Added interactive node dragging with simulation reheating on grab/release
- Integrated with Layout toolbar (new "GRAPH" tab)
- Added `/graph` route to App.jsx

### Bug Fix: Initial Render Crash
- Fixed crash where `dimensions.width` and `dimensions.height` were accessed in useEffect dependency array when `dimensions` was null
- Solution: moved dimension access inside effect body with null check

### Force Simulation UX Tuning
Multiple iterations to achieve natural graph layout:
- Reduced node charge from -400 → -100 → -40 (less aggressive repulsion)
- Shortened link distance from 150 → 60 → 35 (tighter connections)
- Added forceX/forceY with strength 0.05 to pull nodes toward center (prevents drift)
- Reduced node visual size: circle radius 20 → 10 → 6
- Reduced collision radius: 30 → 18 → 10 (matches visual size)
- Fixed initial positioning: nodes now spawn at canvas center instead of (0,0)

### Zoom Implementation
- Added transform state tracking (scale, x, y)
- Implemented scroll wheel zoom with 0.2x to 4x range
- Zoom targets mouse cursor position (not canvas center)
- Updated drag handling to account for zoom transform
- All mouse interactions now properly transformed through zoom/pan state

## Files Created

### Backend
- `backend/force-sim/package.json` - @index/force-sim workspace definition
- `backend/force-sim/simulation.js` - Core force simulation functions
- `backend/force-sim/controls.js` - Node/link manipulation functions
- `backend/force-sim/index.js` - Module entry point
- `backend/force-sim/README.md` - Module documentation

### Frontend
- `frontend/src/pages/GraphView/GraphView.jsx` - Main graph visualization component
- `frontend/src/pages/GraphView/GraphView.css` - Graph view styles

## Files Modified
- `frontend/src/App.jsx` - Added /graph route
- `frontend/src/components/Layout/Layout.jsx` - Added GRAPH tab to toolbar

## Technical Notes
- Force simulation runs in main thread (not worker) for simplicity
- Canvas rendering uses requestAnimationFrame for smooth 60fps
- Zoom transform applied via canvas context transform (not CSS)
- Node dragging temporarily disables zoom to prevent conflicts
- Simulation automatically stops when alpha decays below threshold (0.005)
- Mock data currently used (5 nodes, 4 links) - ready for real data integration
