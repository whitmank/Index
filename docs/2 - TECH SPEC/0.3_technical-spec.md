# Index v0.3 - Technical Specification

> Technical specification documenting architecture, implementation details, and engineering decisions.
> This document focuses on how the system is built, not what users experience.

---

## 1. Architecture Overview

### 1.1 High-Level Architecture Diagram

```
┌──────────────────────────────────────────────────────────────┐
│                    Electron Shell                            │
│  ┌─────────────────┐    ┌────────────────────────────────┐   │
│  │  Main Process   │    │      Renderer (React)          │   │
│  │ - IPC Bridge    │    │ - State Store (Zustand/Jotai)  │   │
│  │ - Source IPC    │    │ - React Components             │   │
│  │ - App lifecycle │    │ - Routing (React Router)       │   │
│  └────────┬────────┘    └───────────┬────────────────────┘   │
└───────────┼──────────────────────────┼─────────────────────────┘
            │                          │
            ▼                          ▼
┌──────────────────────────────────────────────────────────────┐
│                    Core Services Layer                       │
│  ┌───────────────┐  ┌───────────────┐  ┌────────────────┐   │
│  │   Database    │  │   Source      │  │ Source Handlers│   │
│  │  (SurrealDB)  │  │   Router      │  │ ┌────────────┐ │   │
│  │               │  │               │  │ │ file://    │ │   │
│  │ - Objects     │  │ Dispatches    │  │ │ - fs ops   │ │   │
│  │ - Tags        │  │ requests by   │  │ │ - watching │ │   │
│  │ - Links       │  │ scheme        │  │ ├────────────┤ │   │
│  │ - Collections │  │               │  │ │ https://   │ │   │
│  └───────────────┘  └───────────────┘  │ │ - fetch    │ │   │
│                                        │ │ - cache    │ │   │
│                                        │ └────────────┘ │   │
│                                        └────────────────┘   │
└──────────────────────────────────────────────────────────────┘
           │                    │                    │
           ▼                    ▼                    ▼
    ┌────────────────┐  ┌──────────────┐   ┌──────────────┐
    │ Express API    │  │ File System  │   │ Web Requests │
    │  (:3000)       │  │ & Watchers   │   │  (with cache)│
    └────────────────┘  └──────────────┘   └──────────────┘
```

### 1.2 Directory Structure

```
index-workspace/
├── electron/                    # Electron main process
│   ├── main/
│   │   ├── index.js            # Entry point, app lifecycle
│   │   ├── ipc/                # IPC channel handlers
│   │   │   ├── fs-bridge.js    # File system IPC
│   │   │   └── source-ipc.js   # Source handler IPC
│   │   └── services/
│   │       ├── database-manager.js
│   │       └── app-manager.js
│   └── preload/
│       └── preload.js          # Context bridge API
│
├── frontend/                    # React application (Vite)
│   ├── src/
│   │   ├── main.jsx            # Entry point
│   │   ├── App.jsx             # Root component
│   │   ├── store/
│   │   │   └── app-store.js    # Zustand state
│   │   ├── components/         # Reusable UI components
│   │   │   ├── ObjectListTable.jsx
│   │   │   ├── DetailPanel.jsx
│   │   │   ├── GraphView.jsx
│   │   │   ├── CollectionModal.jsx
│   │   │   └── ...
│   │   ├── pages/              # Route-based views
│   │   │   ├── ObjectsView.jsx
│   │   │   ├── TagsView.jsx
│   │   │   ├── CollectionsView.jsx
│   │   │   ├── GraphView.jsx
│   │   │   └── ...
│   │   ├── hooks/              # Custom React hooks
│   │   └── styles/             # Global CSS
│   └── index.html
│
├── backend/                     # Core services
│   ├── database/
│   │   ├── server.js           # Express app & routes
│   │   ├── db-service.js       # SurrealDB wrapper
│   │   └── routes/
│   │       ├── objects.js
│   │       ├── tags.js
│   │       ├── collections.js
│   │       ├── links.js
│   │       └── ...
│   │
│   ├── source-handlers/        # Source handler implementations
│   │   ├── handler-base.js     # Base interface
│   │   ├── file-handler.js     # file:// handler
│   │   ├── https-handler.js    # https:// handler
│   │   └── handler-registry.js # Dispatch logic
│   │
│   └── services/
│       ├── object-service.js   # Object CRUD
│       ├── tag-service.js      # Tag management
│       ├── collection-service.js
│       └── link-service.js
│
├── package.json                # Monorepo workspace config
└── data/                        # Local SurrealDB storage
    └── surrealdb.db
```

### 1.3 Technology Stack

| Layer | Technology | Version | Purpose |
|-------|-----------|---------|---------|
| Desktop Shell | Electron | 39.2.7+ | Cross-platform wrapper |
| Frontend | React | 19.2.3+ | UI framework |
| Build Tool | Vite | 7.2.4+ | Fast dev server & bundler |
| Routing | React Router | 7.12.0+ | Client-side navigation |
| State | Zustand or Jotai | Latest | Global app state |
| Backend API | Express | 5.2.1+ | REST API server |
| Database | SurrealDB | 1.3.2+ | Document database |
| Graph | D3 Force | Latest | Physics simulation |
| CSS | Tailwind or Styled Components | Latest | Styling |

### 1.4 Port Configuration

| Service | Port | Purpose | Dev vs Prod |
|---------|------|---------|------------|
| Vite Dev Server | 5173 | Frontend dev (HMR) | Dev only |
| Express API | 3000 | REST endpoints | Both |
| SurrealDB | 8000 | Database service | Both |

---

## 2. Data Model

### 2.1 Objects (Core Entity)

**Table:** `objects`

```typescript
{
  id: "objects:ulid",           // Unique identifier

  // Source identification
  source: "file:///path/to/file.pdf",  // URI to object source
  type: "file",                 // Type category: "file", "url", etc.

  // Object identity
  name: "Report Q4",            // User-visible name (optional, auto-derived)

  // Content fingerprint (optional, for deduplication)
  content_hash: "sha256:abc...", // For detecting duplicates

  // Timestamps
  created_at: ISO8601,          // When added to Index
  modified_at: ISO8601,         // Last changed in Index
  source_modified_at: ISO8601,  // Last change at source

  // Source-extracted metadata (read-only)
  source_meta: {
    size?: number,              // Bytes (file)
    mime_type?: string,         // MIME type
    extension?: string,         // File extension (file:// only)
    title?: string,             // Page title (https:// only)
    description?: string,       // Meta description
    favicon?: string,           // Base64 favicon URL
    domain?: string,            // Domain (https:// only)
  },

  // User-defined metadata
  user_meta: {
    notes?: string,             // User notes
    // Future: custom fields
  }
}
```

### 2.2 Tag Definitions & Assignments

**Tables:** `tag_definitions`, `tag_assignments`

**TagDefinition:**
```typescript
{
  id: "tag_definitions:ulid",
  name: "important",            // Unique tag name
  color?: string,               // Hex color code (e.g., "#FF5733")
  description?: string,         // Optional description
  created_at: ISO8601,
}
```

**TagAssignment:**
```typescript
{
  id: "tag_assignments:ulid",
  tag_id: "tag_definitions:abc",
  object_id: "objects:xyz",
  created_at: ISO8601,
}
```

**Benefits:**
- Rename tag globally by updating TagDefinition
- Bulk operations on all objects with a tag
- Tag properties (color, description) centralized
- Query efficiency for tag lookups

### 2.3 Collections

**Table:** `collections`

```typescript
{
  id: "collections:ulid",
  name: "Active Projects",
  description?: string,         // Optional description

  // Query rules
  query: {
    all?: ["tag1", "tag2"],     // Objects with ALL tags (AND)
    any?: ["tag3", "tag4"],     // Objects with ANY tags (OR)
    none?: ["archived"],        // Objects without these tags (NOT)
  },

  // Display
  color?: string,               // Hex color code
  pinned?: boolean,             // Pinned to sidebar

  // Metadata
  created_at: ISO8601,
  modified_at: ISO8601,
}
```

**Query Resolution:**
```
Result = (has_all_tags AND has_any_tag) AND NOT(has_none_tag)

Examples:
query: { all: ["active", "project"] }
→ Objects with BOTH "active" AND "project"

query: { all: ["project"], any: ["urgent", "review"] }
→ Objects with "project" AND ("urgent" OR "review")

query: { any: ["urgent", "review"], none: ["archived"] }
→ Objects with ("urgent" OR "review") but NOT "archived"
```

### 2.4 Links

**Table:** `links`

```typescript
{
  id: "links:ulid",
  source_object: "objects:abc",
  target_object: "objects:xyz",
  type: "related",              // "related", "derivative", "reference"
  label?: string,               // User description ("references", "cited by")
  bidirectional: boolean,       // If true, visible from both objects
  created_at: ISO8601,
  modified_at: ISO8601,
  metadata?: Record<string, unknown>, // Future extensibility
}
```

---

## 3. Source Handler Architecture

### 3.1 Handler Interface

```typescript
interface SourceHandler {
  // Scheme identifier
  scheme: string;               // "file", "https", etc.

  // Validation
  canHandle(uri: string): boolean;
  validate(uri: string): ValidationResult;

  // Metadata extraction
  extractMetadata(uri: string): Promise<Metadata>;

  // Content operations
  getContent(uri: string): Promise<Content | null>;
  getContentHash(uri: string): Promise<string | null>;

  // Capabilities descriptor
  capabilities: {
    canWatch: boolean;          // Watch for changes
    canOpen: boolean;           // Open in native app
    canPreview: boolean;        // Inline preview support
    canCache: boolean;          // Content caching
  };

  // Optional operations
  watch?(uri: string, callback: Watcher): void;
  unwatch?(uri: string): void;
  open?(uri: string): Promise<void>;
  cache?(uri: string): Promise<CachedContent>;
}
```

### 3.2 File Handler (`file://`)

**Location:** `backend/source-handlers/file-handler.js`

**Capabilities:**
- Watch for changes: YES (via chokidar)
- Open in native app: YES (via Electron shell)
- Inline preview: YES (images, text, PDF)
- Content caching: NO (already local)
- Content hash: YES (SHA-256)

**Implementation:**
```typescript
class FileHandler extends SourceHandler {
  scheme = "file";

  canHandle(uri) {
    return uri.startsWith("file://");
  }

  async extractMetadata(uri) {
    // Convert URI to path
    // Use fs.stat to get size, timestamps
    // Use file-type library to detect MIME
    // Return: { size, mime_type, extension, ... }
  }

  async getContentHash(uri) {
    // Stream file through SHA-256 hash
    // Return hex digest
  }

  watch(uri, callback) {
    // Use chokidar to watch path
    // Call callback on file changes
  }

  async open(uri) {
    // Use Electron shell.openPath(path)
  }
}
```

### 3.3 URL Handler (`https://`)

**Location:** `backend/source-handlers/https-handler.js`

**Capabilities:**
- Watch for changes: NO
- Open in native app: YES (browser)
- Inline preview: YES (with caching)
- Content caching: YES
- Content hash: YES (of cached content)

**Implementation:**
```typescript
class HttpsHandler extends SourceHandler {
  scheme = "https";
  cacheDir = "~/.index/cache";

  async extractMetadata(uri) {
    // Fetch page with HEAD request
    // Parse HTML for title, description, favicon
    // Return: { title, description, favicon, mime_type, ... }
  }

  async getContent(uri) {
    // Check cache first
    // If not cached: fetch full content
    // Store in cache with timestamp
    // Return cached content
  }

  async getContentHash(uri) {
    // Get cached content
    // SHA-256 hash of cached content
    // Return hex digest
  }

  async open(uri) {
    // Use Electron shell.openExternal(uri)
  }
}
```

### 3.4 Handler Registry & Dispatch

**Location:** `backend/source-handlers/handler-registry.js`

```typescript
class SourceRegistry {
  handlers: Map<string, SourceHandler>;

  register(handler: SourceHandler) {
    this.handlers.set(handler.scheme, handler);
  }

  async dispatch(uri: string, operation: string, ...args) {
    const handler = this.findHandler(uri);
    if (!handler) throw new Error(`No handler for URI: ${uri}`);
    return handler[operation](uri, ...args);
  }

  findHandler(uri: string): SourceHandler {
    for (const handler of this.handlers.values()) {
      if (handler.canHandle(uri)) return handler;
    }
    return null;
  }
}
```

---

## 4. API Layer

### 4.1 Express Server Structure

**Location:** `backend/database/server.js`

```typescript
import express from 'express';
import cors from 'cors';
import { setupRoutes } from './routes/index.js';

const app = express();
app.use(cors());
app.use(express.json());

// Health check
app.get('/health', (req, res) => res.json({ status: 'ok' }));

// Setup modular routes
setupRoutes(app);

export default app;
```

### 4.2 Route Organization

**Object Routes:** `backend/database/routes/objects.js`

| Method | Endpoint | Handler | Purpose |
|--------|----------|---------|---------|
| GET | `/api/objects` | listObjects | List all objects with filters |
| GET | `/api/objects/:id` | getObject | Fetch single object |
| POST | `/api/objects` | createObject | Create new object |
| PUT | `/api/objects/:id` | updateObject | Update object metadata |
| DELETE | `/api/objects/:id` | deleteObject | Delete object |

**Tag Routes:** `backend/database/routes/tags.js`

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/tags` | List all TagDefinitions |
| POST | `/api/tags` | Create TagDefinition |
| PUT | `/api/tags/:id` | Update TagDefinition |
| DELETE | `/api/tags/:id` | Delete TagDefinition |
| POST | `/api/tags/assign` | Create TagAssignment |
| DELETE | `/api/tags/assign/:id` | Remove TagAssignment |
| GET | `/api/objects/:id/tags` | Get tags for object |

**Collection Routes:** `backend/database/routes/collections.js`

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/collections` | List all collections |
| GET | `/api/collections/:id` | Get single collection |
| GET | `/api/collections/:id/objects` | Get objects in collection |
| POST | `/api/collections` | Create collection |
| PUT | `/api/collections/:id` | Update collection |
| DELETE | `/api/collections/:id` | Delete collection |

**Link Routes:** `backend/database/routes/links.js`

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/links` | List all links |
| POST | `/api/links` | Create link |
| PUT | `/api/links/:id` | Update link |
| DELETE | `/api/links/:id` | Delete link |

**Import Routes:** `backend/database/routes/import.js`

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/api/objects/import` | Import file or URL |

---

## 5. Frontend State Management

### 5.1 State Store (Zustand)

**Location:** `frontend/src/store/app-store.js`

```typescript
import { create } from 'zustand';

export const useAppStore = create((set) => ({
  // Data collections
  objects: new Map(),
  tags: new Map(),
  collections: new Map(),
  links: new Map(),

  // UI state
  selectedObjectIds: new Set(),
  detailPanelOpen: true,
  sidebarCollapsed: false,
  currentView: 'all-objects',

  // Loading state
  loading: false,
  error: null,

  // Actions
  setObjects: (objects) => set({ objects: new Map(objects) }),
  addObject: (object) => set((state) => {
    state.objects.set(object.id, object);
    return { objects: new Map(state.objects) };
  }),
  updateObject: (id, updates) => set((state) => {
    const obj = state.objects.get(id);
    state.objects.set(id, { ...obj, ...updates });
    return { objects: new Map(state.objects) };
  }),
  deleteObject: (id) => set((state) => {
    state.objects.delete(id);
    return { objects: new Map(state.objects) };
  }),

  // Selection
  toggleSelect: (id) => set((state) => {
    const selected = new Set(state.selectedObjectIds);
    selected.has(id) ? selected.delete(id) : selected.add(id);
    return { selectedObjectIds: selected };
  }),
  clearSelection: () => set({ selectedObjectIds: new Set() }),

  // ... similar for tags, collections, links
}));
```

### 5.2 Custom Hooks

**Location:** `frontend/src/hooks/`

```typescript
// useObjects.js
export function useObjects() {
  const { objects, setObjects } = useAppStore();

  useEffect(() => {
    fetchObjects().then(setObjects);
  }, []);

  return objects;
}

// useSelection.js
export function useSelection() {
  const { selectedObjectIds, toggleSelect, clearSelection } = useAppStore();

  return {
    selected: selectedObjectIds,
    toggle: toggleSelect,
    clear: clearSelection,
    isSelected: (id) => selectedObjectIds.has(id),
  };
}
```

---

## 6. Frontend Components

### 6.1 Core Components

**ObjectListTable.jsx** - Reusable table for displaying objects
- Props: `objects`, `selectedIds`, `onSelect`, `sortBy`, `onSort`
- Features: Multi-select, sorting, custom columns

**DetailPanel.jsx** - Right sidebar showing object details
- Props: `objectId`, `onClose`
- Displays: Metadata, tags, notes, links, actions

**GraphView.jsx** - D3 force-directed visualization
- Props: `objects`, `links`
- Features: Drag, zoom, pan, hover tooltips

**CollectionModal.jsx** - Create/edit collections
- Props: `collection?`, `tags`, `onSave`
- Features: Tag selector, AND/OR/NOT builder

**SearchInput.jsx** - Smart search with autocomplete
- Props: `onSearch`
- Features: Tag suggestions, recent searches

### 6.2 Layout Components

**Layout.jsx** - Main wrapper
- Contains: Navbar, Sidebar, MainContent, DetailPanel
- Manages: Global UI state, responsive breakpoints

**Sidebar.jsx** - Navigation + collections
- Shows: All views, pinned collections
- Features: Collapse/expand, create collection

**Navbar.jsx** - Top bar
- Shows: App title, import buttons, search
- Features: File/URL import dialogs

---

## 7. IPC Communication

### 7.1 Main Process IPC Handlers

**File System Bridge:** `electron/main/ipc/fs-bridge.js`

```typescript
ipcMain.handle('fs:select-directory', async () => {
  const { filePaths } = await dialog.showOpenDialog({
    properties: ['openDirectory']
  });
  return filePaths[0];
});

ipcMain.handle('fs:select-files', async () => {
  const { filePaths } = await dialog.showOpenDialog({
    properties: ['openFile', 'multiSelections']
  });
  return filePaths;
});

ipcMain.handle('fs:get-metadata', async (event, path) => {
  const stat = await fs.stat(path);
  const type = await detectMimeType(path);
  return { ...stat, type };
});

ipcMain.on('fs:watch-path', (event, path) => {
  const watcher = chokidar.watch(path);
  watcher.on('change', () => {
    event.sender.send('fs:path-changed', path);
  });
  watchers.set(path, watcher);
});
```

**Source Handler Bridge:** `electron/main/ipc/source-ipc.js`

```typescript
ipcMain.handle('source:extract-metadata', async (event, uri) => {
  return sourceRegistry.dispatch(uri, 'extractMetadata');
});

ipcMain.handle('source:open', async (event, uri) => {
  return sourceRegistry.dispatch(uri, 'open');
});

ipcMain.handle('source:get-hash', async (event, uri) => {
  return sourceRegistry.dispatch(uri, 'getContentHash');
});
```

### 7.2 Preload Script

**Location:** `electron/preload/preload.js`

```typescript
import { contextBridge, ipcRenderer } from 'electron';

contextBridge.exposeInMainWorld('electronAPI', {
  // File system
  selectDirectory: () => ipcRenderer.invoke('fs:select-directory'),
  selectFiles: () => ipcRenderer.invoke('fs:select-files'),
  getFileMetadata: (path) => ipcRenderer.invoke('fs:get-metadata', path),
  watchPath: (path, callback) => {
    ipcRenderer.on('fs:path-changed', (event, changedPath) => {
      if (changedPath === path) callback();
    });
  },

  // Source operations
  extractMetadata: (uri) => ipcRenderer.invoke('source:extract-metadata', uri),
  openSource: (uri) => ipcRenderer.invoke('source:open', uri),
  getContentHash: (uri) => ipcRenderer.invoke('source:get-hash', uri),
});
```

---

## 8. Database Service

### 8.1 SurrealDB Setup

**Location:** `backend/database/db-service.js`

```typescript
import Surreal from 'surrealdb.js';

export class DBService {
  constructor() {
    this.db = new Surreal();
  }

  async connect(url) {
    await this.db.connect(url);
    await this.db.use('index', 'default');
  }

  async query(sql, vars = {}) {
    return this.db.query(sql, vars);
  }

  async create(table, data) {
    return this.db.create(`${table}:${v4()}`, data);
  }

  async update(id, data) {
    return this.db.update(id, data);
  }

  async delete(id) {
    return this.db.delete(id);
  }
}
```

### 8.2 Query Examples

```typescript
// Get all objects with a tag
const query = `
  SELECT objects.* FROM objects
  WHERE id IN (
    SELECT object_id FROM tag_assignments
    WHERE tag_id = $tag_id
  )
`;

// Get objects matching collection query
const query = `
  SELECT * FROM objects
  WHERE (
    id IN (
      SELECT object_id FROM tag_assignments
      WHERE tag_id IN (
        SELECT id FROM tag_definitions
        WHERE name IN $all_tags
      )
    )
  ) OR (
    id IN (
      SELECT object_id FROM tag_assignments
      WHERE tag_id IN (
        SELECT id FROM tag_definitions
        WHERE name IN $any_tags
      )
    )
  ) AND (
    id NOT IN (
      SELECT object_id FROM tag_assignments
      WHERE tag_id IN (
        SELECT id FROM tag_definitions
        WHERE name IN $none_tags
      )
    )
  )
`;
```

---

## 9. Development Workflow

### 9.1 Development Commands

```bash
# Install dependencies
npm install

# Start all services
npm run dev          # Database + frontend dev server

# Start individual services
npm run db:start     # SurrealDB only
npm run frontend:dev # Vite dev server
npm run backend:dev  # Express server

# Start Electron
npm run electron:dev # With dev server

# Building
npm run build        # Build frontend + Electron
npm run package      # Package for distribution
```

### 9.2 Environment Variables

```env
# .env.local
VITE_API_URL=http://localhost:3000
SURREAL_URL=http://localhost:8000
NODE_ENV=development
```

### 9.3 Testing Strategy

- **Unit:** Components, utilities, services
- **Integration:** API endpoints, database operations
- **E2E:** User workflows (Playwright/Cypress)
- **Performance:** Graph rendering, object list virtualization

---

## 10. Performance Considerations

### 10.1 Optimization Strategies

**Frontend:**
- Virtualize long object lists (1000+ items)
- Memoize component renders with React.memo
- Lazy load routes with React.lazy
- Debounce search and filter operations

**Backend:**
- Index database queries on frequently-searched fields
- Pagination for large result sets (limit 100 per request)
- Cache metadata extraction results
- Async operations for file hashing

**Graph:**
- Limit force simulation to <1000 nodes
- Use canvas rendering for performance
- Progressive node rendering (load in chunks)
- Prune invisible links during simulation

### 10.2 Monitoring

- Log operation times
- Track error rates
- Monitor memory usage
- Profile render performance

---

## 11. Security Implementation

### 11.1 Electron Security

- Context isolation: ENABLED
- Sandbox: ENABLED
- nodeIntegration: DISABLED
- preload: Required for IPC
- CSP headers on all responses

### 11.2 Input Validation

- Sanitize all user input before database operations
- Validate URIs before dispatching to handlers
- Prevent path traversal in file operations
- Validate JSON in API requests

### 11.3 Data Access

- Users can only access files they have OS permissions for
- Index respects OS file ACLs
- No hardcoded credentials
- Sensitive data never logged

---

## 12. Migration from v0.2

### 12.1 Data Migration Script

**Location:** `scripts/migrate-v0.2-to-v0.3.js`

Steps:
1. Read v0.2 SurrealDB
2. Transform nodes → objects with URIs
3. Transform tags → tag_definitions + tag_assignments
4. Transform collections → new query format
5. Transform links → new format
6. Write to v0.3 database
7. Verify data integrity

### 12.2 Breaking Changes

| Aspect | v0.2 | v0.3 |
|--------|------|------|
| Entity | Node | Object |
| ID Prefix | `nodes:` | `objects:` |
| Location | `source_path` | `source` (URI) |
| Metadata | Single `metadata` | `source_meta` + `user_meta` |
| Tags | Direct assignment | TagDefinition + TagAssignment |
| Collections | `tags` array | `query` object with AND/OR/NOT |
| Links | `strength` field | `label` + `bidirectional` |
| API | `/api/nodes` | `/api/objects` |

---

## 13. Future Extensibility

### 13.1 Adding New Source Handlers

1. Create `backend/source-handlers/[scheme]-handler.js`
2. Extend SourceHandler interface
3. Register in SourceRegistry
4. Add UI indicators in frontend

Example: Implementing `notion://` handler
```typescript
class NotionHandler extends SourceHandler {
  scheme = "notion";

  async extractMetadata(uri) {
    // Use Notion API to fetch page data
    // Return title, icon, last edited, etc.
  }

  async open(uri) {
    // Open Notion page in browser
  }
}

sourceRegistry.register(new NotionHandler());
```

### 13.2 Plugin Architecture (Future)

- Source handlers as plugins
- Custom metadata extraction
- Alternative storage backends
- Visualization modes

---

*Technical specification for v0.3*
*Covers architecture, implementation, and engineering decisions*
*Referenced from v0.2 final-spec and v0.3 pre-spec*
*January 2026*
